<div class="p-6 max-w-7xl mx-auto">
  <header class="flex items-center justify-between mb-8">
    <div>
      <h2 class="text-4xl font-extrabold tracking-tight text-gray-900">Cafetería</h2>
      <p class="mt-1 text-sm text-gray-500">Descubre nuestros productos con ofertas exclusivas</p>
    </div>
    <div>
      <select
        class="w-60 md:w-72 border border-gray-200 rounded-lg bg-white px-4 py-2 text-sm text-gray-700 shadow-sm cursor-pointer focus:outline-none focus:ring-2 focus:ring-amber-300 focus:border-amber-300 transition"
        [(ngModel)]="selectedCategory"
        (change)="filterCategory(selectedCategory)"
        title="Filtrar por categoría"
      >
        <option *ngFor="let c of categories" [value]="c">{{ c }}</option>
      </select>
    </div>
  </header>

  <section class="mb-6">
    <div class="bg-amber-50 border rounded p-4">
      <strong>Promociones Activas</strong>
      <div *ngIf="(activePromotions$ | async) as promos">
        <p *ngFor="let promo of promos" class="mt-2">{{ promo.name }} - {{ promo.discountPercentage }}% OFF</p>
      </div>
    </div>
  </section>

  <section class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
    <ng-container *ngFor="let p of filtered">
      <article class="bg-white border border-gray-200 rounded-2xl shadow-sm overflow-hidden relative">
        <img [src]="p.image" alt="{{ p.name }}" class="w-full h-48 md:h-56 object-cover" />
        <ng-container [ngTemplateOutlet]="cardBody" [ngTemplateOutletContext]="{ $implicit: p, priced: pricedOf(p) }"></ng-container>
      </article>
    </ng-container>

    <ng-template #cardBody let-prod let-priced="priced">
      <span *ngIf="priced.discount > 0" class="absolute top-3 right-3 bg-red-500 text-white text-[11px] font-semibold px-3 py-1 rounded-full">-{{ priced.discount }}% OFF</span>
      <div class="p-5">
        <h3 class="font-semibold text-lg text-gray-900">{{ prod.name }}</h3>
        <p class="text-gray-500 text-sm">{{ prod.description }}</p>

        <span *ngIf="prod.category" class="inline-flex items-center mt-3 px-3 py-1 rounded-full border text-xs text-gray-700 bg-white">
          {{ prod.category }}
        </span>

        <div class="mt-3">
          <div class="text-green-600 font-bold text-xl">
            ${{ priced.price.toFixed(2) }}
            <span *ngIf="priced.discount > 0" class="text-gray-400 line-through ml-2 align-middle text-base">${{ prod.price.toFixed(2) }}</span>
          </div>
          <div class="text-xs text-gray-500 mt-1">Stock disponible: {{ prod.stock }}</div>
        </div>

        <div class="mt-4 border-t pt-4">
          <button class="w-full inline-flex items-center justify-center gap-2 bg-slate-900 hover:bg-slate-800 text-white px-4 py-2.5 rounded-lg transition"
                  (click)="addToCart(prod)">
            <img src="/assets/icons/cart.svg" alt="" class="h-4 w-4" />
            <span>Agregar al Carrito</span>
          </button>
        </div>
      </div>
    </ng-template>
  </section>
</div>
